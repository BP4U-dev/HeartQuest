<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Avatar Creator - Love Connect 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000000;
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            padding: 20px 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            box-shadow: 0 2px 20px rgba(139, 0, 0, 0.5);
            border-bottom: 2px solid #8B0000;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #8B0000, #DC143C, #FF6347);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(139, 0, 0, 0.8);
            margin-bottom: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 600px 1fr;
            gap: 30px;
            align-items: start;
        }

        .avatar-3d-container {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            border: 3px solid #8B0000;
            box-shadow: 0 10px 40px rgba(139, 0, 0, 0.4);
            position: relative;
            height: 600px;
        }

        #avatar3D {
            width: 100%;
            height: 500px;
            border-radius: 15px;
            border: 2px solid #8B0000;
            background: linear-gradient(45deg, rgba(139, 0, 0, 0.1), rgba(0, 0, 0, 0.95));
        }

        .controls-3d {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .control-btn {
            background: rgba(139, 0, 0, 0.3);
            border: 2px solid #8B0000;
            padding: 8px 12px;
            border-radius: 10px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(139, 0, 0, 0.6);
            border-color: #DC143C;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 0, 0, 0.4);
        }

        .customization-panel {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 3px solid #8B0000;
            box-shadow: 0 10px 40px rgba(139, 0, 0, 0.4);
            max-height: 80vh;
            overflow-y: auto;
        }

        .panel-title {
            font-size: 1.5rem;
            color: #DC143C;
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #8B0000;
        }

        .section {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(139, 0, 0, 0.1);
            border-radius: 15px;
            border: 1px solid #8B0000;
        }

        .section-title {
            font-size: 1.1rem;
            color: #DC143C;
            margin-bottom: 15px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .slider-group {
            margin-bottom: 20px;
        }

        .slider-group label {
            display: block;
            margin-bottom: 8px;
            color: #e0e0e0;
            font-weight: 500;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: rgba(139, 69, 19, 0.3);
            outline: none;
            transition: background 0.3s;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #CD853F, #DEB887);
            cursor: pointer;
            border: 2px solid #8B4513;
        }

        .color-picker {
            width: 100%;
            height: 40px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid rgba(139, 69, 19, 0.4);
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(139, 69, 19, 0.4);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: #e0e0e0;
            font-size: 1rem;
            cursor: pointer;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #8B4513, #CD853F);
            color: #fff;
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 69, 19, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #DEB887, #F4A460);
            color: #2c1810;
            box-shadow: 0 4px 15px rgba(222, 184, 135, 0.4);
        }

        .animation-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
            gap: 15px;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé® 3D Avatar Creator</h1>
        <p class="subtitle">Create your perfect 3D virtual identity</p>
    </div>

    <div class="container">
        <!-- 3D Avatar Display -->
        <div class="avatar-3d-container">
            <canvas id="avatar3D"></canvas>
            <div class="controls-3d">
                <button class="control-btn" onclick="rotateAvatar('left')">‚¨ÖÔ∏è Rotate Left</button>
                <button class="control-btn" onclick="rotateAvatar('right')">‚û°Ô∏è Rotate Right</button>
                <button class="control-btn" onclick="resetCamera()">üéØ Reset View</button>
            </div>
            <div class="animation-controls">
                <button class="control-btn" onclick="playAnimation('wave')">üëã Wave</button>
                <button class="control-btn" onclick="playAnimation('dance')">üíÉ Dance</button>
                <button class="control-btn" onclick="playAnimation('idle')">üßò Idle</button>
            </div>
        </div>

        <!-- Customization Panel -->
        <div class="customization-panel">
            <h2 class="panel-title">üé≠ 3D Customization</h2>

            <!-- Body Shape -->
            <div class="section">
                <div class="section-title">Body Shape</div>
                
                <div class="slider-group">
                    <label>Height: <span id="heightValue">1.7m</span></label>
                    <input type="range" class="slider" id="bodyHeight" min="1.5" max="2.0" step="0.05" value="1.7" oninput="updateBodyHeight()">
                </div>

                <div class="slider-group">
                    <label>Body Width: <span id="bodyWidthValue">Normal</span></label>
                    <input type="range" class="slider" id="bodyWidth" min="0.8" max="1.5" step="0.1" value="1.0" oninput="updateBodyWidth()">
                </div>

                <div class="slider-group">
                    <label>Muscle Definition: <span id="muscleValue">50%</span></label>
                    <input type="range" class="slider" id="muscleDefinition" min="0" max="100" value="50" oninput="updateMuscleDefinition()">
                </div>
            </div>

            <!-- Head & Face -->
            <div class="section">
                <div class="section-title">Head & Face</div>
                
                <div class="slider-group">
                    <label>Head Size: <span id="headSizeValue">Normal</span></label>
                    <input type="range" class="slider" id="headSize" min="0.8" max="1.3" step="0.1" value="1.0" oninput="updateHeadSize()">
                </div>

                <div class="slider-group">
                    <label>Skin Color</label>
                    <input type="color" class="color-picker" id="skinColor" value="#f4c2a1" onchange="updateSkinColor()">
                </div>

                <div class="slider-group">
                    <label>Eye Size: <span id="eyeSizeValue">Normal</span></label>
                    <input type="range" class="slider" id="eyeSize" min="0.7" max="1.5" step="0.1" value="1.0" oninput="updateEyeSize()">
                </div>

                <div class="slider-group">
                    <label>Eye Color</label>
                    <input type="color" class="color-picker" id="eyeColor" value="#4169e1" onchange="updateEyeColor()">
                </div>
            </div>

            <!-- Hair -->
            <div class="section">
                <div class="section-title">Hair</div>
                
                <div class="slider-group">
                    <label>Hair Style</label>
                    <select id="hairStyle" onchange="updateHairStyle()">
                        <option value="short">Short Hair</option>
                        <option value="medium">Medium Hair</option>
                        <option value="long">Long Hair</option>
                        <option value="curly">Curly Hair</option>
                        <option value="spiky">Spiky Hair</option>
                        <option value="bald">Bald</option>
                    </select>
                </div>

                <div class="slider-group">
                    <label>Hair Color</label>
                    <input type="color" class="color-picker" id="hairColor" value="#8b4513" onchange="updateHairColor()">
                </div>

                <div class="slider-group">
                    <label>Hair Length: <span id="hairLengthValue">Medium</span></label>
                    <input type="range" class="slider" id="hairLength" min="0.5" max="2.0" step="0.1" value="1.0" oninput="updateHairLength()">
                </div>
            </div>

            <!-- Clothing -->
            <div class="section">
                <div class="section-title">Clothing</div>
                
                <div class="slider-group">
                    <label>Outfit Style</label>
                    <select id="outfitStyle" onchange="updateOutfitStyle()">
                        <option value="casual">Casual Wear</option>
                        <option value="formal">Formal Suit</option>
                        <option value="sporty">Sports Wear</option>
                        <option value="elegant">Elegant Dress</option>
                        <option value="futuristic">Futuristic</option>
                    </select>
                </div>

                <div class="slider-group">
                    <label>Primary Color</label>
                    <input type="color" class="color-picker" id="clothingColor1" value="#4169e1" onchange="updateClothingColors()">
                </div>

                <div class="slider-group">
                    <label>Secondary Color</label>
                    <input type="color" class="color-picker" id="clothingColor2" value="#ffffff" onchange="updateClothingColors()">
                </div>
            </div>

            <!-- Accessories -->
            <div class="section">
                <div class="section-title">Accessories</div>
                
                <div class="slider-group">
                    <label>
                        <input type="checkbox" id="glasses" onchange="toggleAccessory('glasses')"> 
                        üëì Glasses
                    </label>
                </div>

                <div class="slider-group">
                    <label>
                        <input type="checkbox" id="hat" onchange="toggleAccessory('hat')"> 
                        üé© Hat
                    </label>
                </div>

                <div class="slider-group">
                    <label>
                        <input type="checkbox" id="jewelry" onchange="toggleAccessory('jewelry')"> 
                        üíç Jewelry
                    </label>
                </div>

                <div class="slider-group">
                    <label>
                        <input type="checkbox" id="watch" onchange="toggleAccessory('watch')"> 
                        ‚åö Watch
                    </label>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="randomizeAvatar()">üé≤ Randomize</button>
                <button class="btn btn-primary" onclick="saveAvatar()">üíæ Save Avatar</button>
                <button class="btn btn-primary" onclick="exportAvatar()">üìÅ Export Model</button>
            </div>
        </div>
    </div>

    <script>
        // 3D Scene Setup
        let scene, camera, renderer, avatar, animationMixer;
        let bodyParts = {};
        let isAnimating = false;
        let currentAnimation = null;

        // Avatar configuration
        let avatarConfig = {
            bodyHeight: 1.7,
            bodyWidth: 1.0,
            muscleDefinition: 50,
            headSize: 1.0,
            skinColor: '#f4c2a1',
            eyeSize: 1.0,
            eyeColor: '#4169e1',
            hairStyle: 'medium',
            hairColor: '#8b4513',
            hairLength: 1.0,
            outfitStyle: 'casual',
            clothingColor1: '#4169e1',
            clothingColor2: '#ffffff',
            accessories: {
                glasses: false,
                hat: false,
                jewelry: false,
                watch: false
            }
        };

        // Initialize 3D Scene
        function init3D() {
            const canvas = document.getElementById('avatar3D');
            const container = canvas.parentElement;
            
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a1a);
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
            camera.position.set(0, 1.6, 3);
            camera.lookAt(0, 1, 0);
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            const fillLight = new THREE.DirectionalLight(0x8B4513, 0.3);
            fillLight.position.set(-1, 0, -1);
            scene.add(fillLight);
            
            // Create avatar
            createAvatar();
            
            // Animation loop
            animate();
        }

        // Create 3D Avatar
        function createAvatar() {
            avatar = new THREE.Group();
            
            // Body
            const bodyGeometry = new THREE.CylinderGeometry(0.3, 0.4, 1.2, 8);
            const bodyMaterial = new THREE.MeshLambertMaterial({ color: avatarConfig.skinColor });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.6;
            body.castShadow = true;
            bodyParts.body = body;
            avatar.add(body);
            
            // Head
            const headGeometry = new THREE.SphereGeometry(0.25, 16, 16);
            const headMaterial = new THREE.MeshLambertMaterial({ color: avatarConfig.skinColor });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 1.5;
            head.castShadow = true;
            bodyParts.head = head;
            avatar.add(head);
            
            // Eyes
            const eyeGeometry = new THREE.SphereGeometry(0.03, 8, 8);
            const eyeMaterial = new THREE.MeshLambertMaterial({ color: avatarConfig.eyeColor });
            
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(-0.08, 1.55, 0.2);
            bodyParts.leftEye = leftEye;
            avatar.add(leftEye);
            
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.08, 1.55, 0.2);
            bodyParts.rightEye = rightEye;
            avatar.add(rightEye);
            
            // Arms
            const armGeometry = new THREE.CylinderGeometry(0.1, 0.08, 0.8, 8);
            const armMaterial = new THREE.MeshLambertMaterial({ color: avatarConfig.skinColor });
            
            const leftArm = new THREE.Mesh(armGeometry, armMaterial);
            leftArm.position.set(-0.5, 0.8, 0);
            leftArm.rotation.z = 0.3;
            leftArm.castShadow = true;
            bodyParts.leftArm = leftArm;
            avatar.add(leftArm);
            
            const rightArm = new THREE.Mesh(armGeometry, armMaterial);
            rightArm.position.set(0.5, 0.8, 0);
            rightArm.rotation.z = -0.3;
            rightArm.castShadow = true;
            bodyParts.rightArm = rightArm;
            avatar.add(rightArm);
            
            // Legs
            const legGeometry = new THREE.CylinderGeometry(0.12, 0.1, 1.0, 8);
            const legMaterial = new THREE.MeshLambertMaterial({ color: avatarConfig.clothingColor1 });
            
            const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
            leftLeg.position.set(-0.2, -0.5, 0);
            leftLeg.castShadow = true;
            bodyParts.leftLeg = leftLeg;
            avatar.add(leftLeg);
            
            const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
            rightLeg.position.set(0.2, -0.5, 0);
            rightLeg.castShadow = true;
            bodyParts.rightLeg = rightLeg;
            avatar.add(rightLeg);
            
            // Hair
            createHair();
            
            // Clothing
            createClothing();
            
            // Add to scene
            avatar.position.y = 0;
            scene.add(avatar);
            
            // Ground
            const groundGeometry = new THREE.PlaneGeometry(10, 10);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
        }

        // Create Hair
        function createHair() {
            if (bodyParts.hair) {
                avatar.remove(bodyParts.hair);
            }
            
            if (avatarConfig.hairStyle === 'bald') return;
            
            let hairGeometry;
            switch (avatarConfig.hairStyle) {
                case 'short':
                    hairGeometry = new THREE.SphereGeometry(0.28, 16, 8, 0, Math.PI * 2, 0, Math.PI * 0.6);
                    break;
                case 'medium':
                    hairGeometry = new THREE.SphereGeometry(0.32, 16, 16, 0, Math.PI * 2, 0, Math.PI * 0.7);
                    break;
                case 'long':
                    hairGeometry = new THREE.CylinderGeometry(0.3, 0.2, 0.6, 16);
                    break;
                case 'curly':
                    hairGeometry = new THREE.SphereGeometry(0.35, 8, 8);
                    break;
                case 'spiky':
                    hairGeometry = new THREE.ConeGeometry(0.3, 0.4, 8);
                    break;
                default:
                    hairGeometry = new THREE.SphereGeometry(0.3, 16, 16, 0, Math.PI * 2, 0, Math.PI * 0.65);
            }
            
            const hairMaterial = new THREE.MeshLambertMaterial({ color: avatarConfig.hairColor });
            const hair = new THREE.Mesh(hairGeometry, hairMaterial);
            
            if (avatarConfig.hairStyle === 'long') {
                hair.position.y = 1.6;
            } else if (avatarConfig.hairStyle === 'spiky') {
                hair.position.y = 1.7;
            } else {
                hair.position.y = 1.55;
            }
            
            hair.scale.y = avatarConfig.hairLength;
            hair.castShadow = true;
            bodyParts.hair = hair;
            avatar.add(hair);
        }

        // Create Clothing
        function createClothing() {
            // Remove existing clothing
            if (bodyParts.shirt) avatar.remove(bodyParts.shirt);
            if (bodyParts.pants) avatar.remove(bodyParts.pants);
            
            // Shirt/Top
            const shirtGeometry = new THREE.CylinderGeometry(0.32, 0.42, 0.6, 8);
            const shirtMaterial = new THREE.MeshLambertMaterial({ color: avatarConfig.clothingColor1 });
            const shirt = new THREE.Mesh(shirtGeometry, shirtMaterial);
            shirt.position.y = 0.9;
            bodyParts.shirt = shirt;
            avatar.add(shirt);
            
            // Update legs with clothing color
            bodyParts.leftLeg.material.color.setHex(avatarConfig.clothingColor2.replace('#', '0x'));
            bodyParts.rightLeg.material.color.setHex(avatarConfig.clothingColor2.replace('#', '0x'));
        }

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            if (!isAnimating) {
                // Gentle idle animation
                avatar.rotation.y += 0.005;
                avatar.position.y = Math.sin(Date.now() * 0.001) * 0.02;
            }
            
            if (animationMixer) {
                animationMixer.update(0.016);
            }
            
            renderer.render(scene, camera);
        }

        // Control functions
        function rotateAvatar(direction) {
            const rotation = direction === 'left' ? 0.3 : -0.3;
            avatar.rotation.y += rotation;
        }

        function resetCamera() {
            camera.position.set(0, 1.6, 3);
            camera.lookAt(0, 1, 0);
            avatar.rotation.y = 0;
        }

        function playAnimation(type) {
            isAnimating = true;
            
            switch (type) {
                case 'wave':
                    animateWave();
                    break;
                case 'dance':
                    animateDance();
                    break;
                case 'idle':
                    isAnimating = false;
                    break;
            }
        }

        function animateWave() {
            const duration = 2000;
            const startTime = Date.now();
            
            function wave() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                bodyParts.rightArm.rotation.z = -0.3 + Math.sin(progress * Math.PI * 4) * 0.8;
                
                if (progress < 1) {
                    requestAnimationFrame(wave);
                } else {
                    bodyParts.rightArm.rotation.z = -0.3;
                    isAnimating = false;
                }
            }
            
            wave();
        }

        function animateDance() {
            const duration = 4000;
            const startTime = Date.now();
            
            function dance() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const time = progress * Math.PI * 4;
                
                bodyParts.leftArm.rotation.z = 0.3 + Math.sin(time) * 0.5;
                bodyParts.rightArm.rotation.z = -0.3 + Math.cos(time) * 0.5;
                avatar.position.y = Math.abs(Math.sin(time * 2)) * 0.1;
                
                if (progress < 1) {
                    requestAnimationFrame(dance);
                } else {
                    bodyParts.leftArm.rotation.z = 0.3;
                    bodyParts.rightArm.rotation.z = -0.3;
                    avatar.position.y = 0;
                    isAnimating = false;
                }
            }
            
            dance();
        }

        // Update functions
        function updateBodyHeight() {
            const height = document.getElementById('bodyHeight').value;
            document.getElementById('heightValue').textContent = height + 'm';
            avatarConfig.bodyHeight = parseFloat(height);
            
            const scale = avatarConfig.bodyHeight / 1.7;
            avatar.scale.set(scale, scale, scale);
        }

        function updateBodyWidth() {
            const width = document.getElementById('bodyWidth').value;
            const widthText = width < 0.9 ? 'Slim' : width > 1.2 ? 'Wide' : 'Normal';
            document.getElementById('bodyWidthValue').textContent = widthText;
            avatarConfig.bodyWidth = parseFloat(width);
            
            bodyParts.body.scale.x = avatarConfig.bodyWidth;
            bodyParts.body.scale.z = avatarConfig.bodyWidth;
        }

        function updateMuscleDefinition() {
            const muscle = document.getElementById('muscleDefinition').value;
            document.getElementById('muscleValue').textContent = muscle + '%';
            avatarConfig.muscleDefinition = parseInt(muscle);
            
            const armScale = 1 + (avatarConfig.muscleDefinition / 200);
            bodyParts.leftArm.scale.x = armScale;
            bodyParts.leftArm.scale.z = armScale;
            bodyParts.rightArm.scale.x = armScale;
            bodyParts.rightArm.scale.z = armScale;
        }

        function updateHeadSize() {
        function updateHeadSize() {
            const size = document.getElementById('headSize').value;
            const sizeText = size < 0.9 ? 'Small' : size > 1.1 ? 'Large' : 'Normal';
            document.getElementById('headSizeValue').textContent = sizeText;
            avatarConfig.headSize = parseFloat(size);
            
            bodyParts.head.scale.set(avatarConfig.headSize, avatarConfig.headSize, avatarConfig.headSize);
            bodyParts.leftEye.scale.set(avatarConfig.headSize, avatarConfig.headSize, avatarConfig.headSize);
            bodyParts.rightEye.scale.set(avatarConfig.headSize, avatarConfig.headSize, avatarConfig.headSize);
        }

        function updateSkinColor() {
            const color = document.getElementById('skinColor').value;
            avatarConfig.skinColor = color;
            
            bodyParts.body.material.color.setHex(color.replace('#', '0x'));
            bodyParts.head.material.color.setHex(color.replace('#', '0x'));
            bodyParts.leftArm.material.color.setHex(color.replace('#', '0x'));
            bodyParts.rightArm.material.color.setHex(color.replace('#', '0x'));
        }

        function updateEyeSize() {
            const size = document.getElementById('eyeSize').value;
            const sizeText = size < 0.9 ? 'Small' : size > 1.1 ? 'Large' : 'Normal';
            document.getElementById('eyeSizeValue').textContent = sizeText;
            avatarConfig.eyeSize = parseFloat(size);
            
            bodyParts.leftEye.scale.set(avatarConfig.eyeSize, avatarConfig.eyeSize, avatarConfig.eyeSize);
            bodyParts.rightEye.scale.set(avatarConfig.eyeSize, avatarConfig.eyeSize, avatarConfig.eyeSize);
        }

        function updateEyeColor() {
            const color = document.getElementById('eyeColor').value;
            avatarConfig.eyeColor = color;
            
            bodyParts.leftEye.material.color.setHex(color.replace('#', '0x'));
            bodyParts.rightEye.material.color.setHex(color.replace('#', '0x'));
        }

        function updateHairStyle() {
            avatarConfig.hairStyle = document.getElementById('hairStyle').value;
            createHair();
        }

        function updateHairColor() {
            const color = document.getElementById('hairColor').value;
            avatarConfig.hairColor = color;
            
            if (bodyParts.hair) {
                bodyParts.hair.material.color.setHex(color.replace('#', '0x'));
            }
        }

        function updateHairLength() {
            const length = document.getElementById('hairLength').value;
            const lengthText = length < 0.8 ? 'Short' : length > 1.5 ? 'Long' : 'Medium';
            document.getElementById('hairLengthValue').textContent = lengthText;
            avatarConfig.hairLength = parseFloat(length);
            
            if (bodyParts.hair) {
                bodyParts.hair.scale.y = avatarConfig.hairLength;
            }
        }

        function updateOutfitStyle() {
            avatarConfig.outfitStyle = document.getElementById('outfitStyle').value;
            createClothing();
        }

        function updateClothingColors() {
            avatarConfig.clothingColor1 = document.getElementById('clothingColor1').value;
            avatarConfig.clothingColor2 = document.getElementById('clothingColor2').value;
            createClothing();
        }

        function toggleAccessory(accessory) {
            avatarConfig.accessories[accessory] = document.getElementById(accessory).checked;
            updateAccessories();
        }

        function updateAccessories() {
            // Remove existing accessories
            ['glasses', 'hat', 'jewelry', 'watch'].forEach(acc => {
                if (bodyParts[acc]) {
                    avatar.remove(bodyParts[acc]);
                    delete bodyParts[acc];
                }
            });

            // Add selected accessories
            if (avatarConfig.accessories.glasses) {
                const glassesGeometry = new THREE.TorusGeometry(0.08, 0.01, 8, 16);
                const glassesMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
                const glasses = new THREE.Mesh(glassesGeometry, glassesMaterial);
                glasses.position.set(0, 1.5, 0.2);
                glasses.rotation.y = Math.PI / 2;
                bodyParts.glasses = glasses;
                avatar.add(glasses);
            }

            if (avatarConfig.accessories.hat) {
                const hatGeometry = new THREE.CylinderGeometry(0.3, 0.25, 0.2, 16);
                const hatMaterial = new THREE.MeshLambertMaterial({ color: 0x8B0000 });
                const hat = new THREE.Mesh(hatGeometry, hatMaterial);
                hat.position.set(0, 1.8, 0);
                bodyParts.hat = hat;
                avatar.add(hat);
            }

            if (avatarConfig.accessories.jewelry) {
                const necklaceGeometry = new THREE.TorusGeometry(0.15, 0.02, 8, 16);
                const necklaceMaterial = new THREE.MeshLambertMaterial({ color: 0xFFD700 });
                const necklace = new THREE.Mesh(necklaceGeometry, necklaceMaterial);
                necklace.position.set(0, 1.2, 0.15);
                necklace.rotation.x = Math.PI / 2;
                bodyParts.jewelry = necklace;
                avatar.add(necklace);
            }

            if (avatarConfig.accessories.watch) {
                const watchGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.03, 16);
                const watchMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
                const watch = new THREE.Mesh(watchGeometry, watchMaterial);
                watch.position.set(0.4, 0.6, 0);
                watch.rotation.z = Math.PI / 2;
                bodyParts.watch = watch;
                avatar.add(watch);
            }
        }

        function randomizeAvatar() {
            // Randomize all values
            document.getElementById('bodyHeight').value = (Math.random() * 0.5 + 1.5).toFixed(2);
            document.getElementById('bodyWidth').value = (Math.random() * 0.7 + 0.8).toFixed(1);
            document.getElementById('muscleDefinition').value = Math.floor(Math.random() * 100);
            document.getElementById('headSize').value = (Math.random() * 0.5 + 0.8).toFixed(1);
            document.getElementById('eyeSize').value = (Math.random() * 0.8 + 0.7).toFixed(1);
            document.getElementById('hairLength').value = (Math.random() * 1.5 + 0.5).toFixed(1);

            // Random colors
            document.getElementById('skinColor').value = getRandomSkinColor();
            document.getElementById('eyeColor').value = getRandomColor();
            document.getElementById('hairColor').value = getRandomHairColor();
            document.getElementById('clothingColor1').value = getRandomColor();
            document.getElementById('clothingColor2').value = getRandomColor();

            // Random selections
            const hairStyles = ['short', 'medium', 'long', 'curly', 'spiky', 'bald'];
            const outfitStyles = ['casual', 'formal', 'sporty', 'elegant', 'futuristic'];
            
            document.getElementById('hairStyle').value = hairStyles[Math.floor(Math.random() * hairStyles.length)];
            document.getElementById('outfitStyle').value = outfitStyles[Math.floor(Math.random() * outfitStyles.length)];

            // Random accessories
            document.getElementById('glasses').checked = Math.random() > 0.5;
            document.getElementById('hat').checked = Math.random() > 0.7;
            document.getElementById('jewelry').checked = Math.random() > 0.6;
            document.getElementById('watch').checked = Math.random() > 0.8;

            // Apply all updates
            updateAllAvatar();
        }

        function getRandomSkinColor() {
            const skinTones = ['#f4c2a1', '#deb887', '#cd853f', '#8b4513', '#654321', '#f5deb3'];
            return skinTones[Math.floor(Math.random() * skinTones.length)];
        }

        function getRandomHairColor() {
            const hairColors = ['#000000', '#8b4513', '#654321', '#daa520', '#b8860b', '#ff6347'];
            return hairColors[Math.floor(Math.random() * hairColors.length)];
        }

        function getRandomColor() {
            return '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
        }

        function updateAllAvatar() {
            updateBodyHeight();
            updateBodyWidth();
            updateMuscleDefinition();
            updateHeadSize();
            updateSkinColor();
            updateEyeSize();
            updateEyeColor();
            updateHairStyle();
            updateHairColor();
            updateHairLength();
            updateOutfitStyle();
            updateClothingColors();
            updateAccessories();
        }

        function saveAvatar() {
            const avatarData = JSON.stringify(avatarConfig);
            localStorage.setItem('loveConnect3D_avatar', avatarData);
            
            // Show success animation
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ Saved!';
            btn.style.background = 'linear-gradient(45deg, #228B22, #32CD32)';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = 'linear-gradient(45deg, #8B0000, #DC143C)';
            }, 2000);

            console.log('Avatar saved:', avatarConfig);
        }

        function exportAvatar() {
            const avatarData = {
                config: avatarConfig,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };

            const dataStr = JSON.stringify(avatarData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'avatar_' + Date.now() + '.json';
            link.click();

            console.log('Avatar exported:', avatarData);
        }

        // Window resize handler
        function onWindowResize() {
            const canvas = document.getElementById('avatar3D');
            camera.aspect = canvas.clientWidth / canvas.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        }

        window.addEventListener('resize', onWindowResize);

        // Load saved avatar
        function loadSavedAvatar() {
            const saved = localStorage.getItem('loveConnect3D_avatar');
            if (saved) {
                try {
                    const savedConfig = JSON.parse(saved);
                    avatarConfig = { ...avatarConfig, ...savedConfig };
                    
                    // Update form values
                    Object.keys(avatarConfig).forEach(key => {
                        const element = document.getElementById(key) || document.getElementById(key.replace(/([A-Z])/g, '$1').toLowerCase());
                        if (element) {
                            if (element.type === 'checkbox') {
                                element.checked = avatarConfig[key];
                            } else {
                                element.value = avatarConfig[key];
                            }
                        }
                    });

                    console.log('Avatar loaded:', avatarConfig);
                } catch (e) {
                    console.error('Could not load saved avatar:', e);
                }
            }
        }

        // Initialize everything when page loads
        window.addEventListener('load', () => {
            console.log('Initializing 3D Avatar Creator...');
            
            // Check Three.js availability
            if (typeof THREE === 'undefined') {
                console.error('Three.js not loaded!');
                document.getElementById('avatar3D').innerHTML = '<p style="color: red; text-align: center; padding: 50px;">Three.js failed to load. Please check your internet connection.</p>';
                return;
            }

            try {
                init3D();
                loadSavedAvatar();
                updateAllAvatar();
                console.log('3D Avatar Creator initialized successfully!');
            } catch (error) {
                console.error('Failed to initialize 3D scene:', error);
                document.getElementById('avatar3D').innerHTML = '<p style="color: red; text-align: center; padding: 50px;">Failed to initialize 3D scene. Your browser may not support WebGL.</p>';
            }
        });

        // Add some debug info
        console.log('3D Avatar Creator script loaded');
    </script>
</body>
</html>